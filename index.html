<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Acompanhamento - Costur Confecções</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS ORIGINAIS - NÃO ALTERAR */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --text: #333;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --purple: #9b59b6;
            --info: #3498db;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text);
            line-height: 1.2;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 10px 0;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .logo {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid var(--secondary);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text h1 {
            font-size: 1.1rem;
            margin-bottom: 1px;
            color: white;
        }

        .logo-text p {
            font-style: italic;
            opacity: 0.9;
            font-size: 0.7rem;
            color: white;
        }

        .header-contact {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFF;
            font-size: 0.7rem;
        }

        .contact-item i {
            color: #FFF;
            font-size: 0.6rem;
        }

        /* Sections */
        section {
            padding: 20px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
        }

        .section-title h2 {
            font-size: 1.5rem;
            color: var(--primary);
            display: inline-block;
            padding-bottom: 5px;
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 2px;
            background-color: var(--secondary);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Painel de Acompanhamento */
        .dashboard {
            background-color: var(--light);
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        /* Filtro */
        .filter-container {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }

        .filter-container h4 {
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-select {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.75rem;
            background-color: white;
        }

        .filter-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background-color 0.3s;
        }

        .filter-btn:hover {
            background-color: #2980b9;
        }

        /* Formulário */
        .form-container {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .form-container h3 {
            margin-bottom: 12px;
            color: var(--primary);
            border-bottom: 1px solid var(--secondary);
            padding-bottom: 6px;
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.75rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.75rem;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--secondary);
            outline: none;
        }

        /* NOVO ESTILO - Campo de foto */
        .foto-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .foto-preview {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .foto-preview:hover {
            border-color: var(--secondary);
        }

        .foto-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .foto-preview i {
            font-size: 1.5rem;
            color: #aaa;
        }

        .foto-upload {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .foto-upload input[type="file"] {
            width: 100%;
            padding: 4px;
            font-size: 0.7rem;
        }

        .foto-url-input {
            font-size: 0.7rem;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
        }

        .foto-remove-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.65rem;
            align-self: flex-start;
        }

        .foto-remove-btn:hover {
            background-color: #c0392b;
        }

        .form-actions {
            display: flex;
            gap: 6px;
            margin-top: 12px;
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 6px 12px;
            border-radius: 3px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            flex: 1;
            text-align: center;
            font-size: 0.7rem;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-purple {
            background-color: var(--purple);
        }

        .btn-purple:hover {
            background-color: #8e44ad;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-info:hover {
            background-color: #2980b9;
        }

        /* Botão para gerenciar modelos - MESMO ESTILO DOS OUTROS */
        .modelos-btn-container {
            margin-bottom: 12px;
            text-align: left;
        }
        
        .btn-modelos {
            background-color: var(--purple);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-modelos:hover {
            background-color: #8e44ad;
        }

        /* Visualização Rápida - SUPER COMPACTA E COLADA */
        .quick-view-container {
            display: flex;
            flex-direction: column;
            gap: 0; /* SEM ESPAÇO ENTRE OS ITENS */
        }

        .quick-view-item {
            background-color: white;
            padding: 8px 10px;
            border-bottom: 1px solid #eee; /* Linha divisória sutil */
            transition: all 0.2s ease;
            min-height: 60px; /* Altura bem reduzida */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .quick-view-item:hover {
            background-color: #f8f9fa;
        }

        .quick-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .quick-view-cliente {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.8rem;
        }

        .quick-view-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: bold;
            color: white;
            white-space: nowrap;
        }

        .status-aguardando {
            background-color: var(--warning);
        }

        .status-producao {
            background-color: var(--secondary);
        }

        .status-realizado {
            background-color: var(--success);
        }

        .status-parado {
            background-color: var(--danger);
        }

        .quick-view-details-compact {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            font-size: 0.65rem;
        }

        .detail-compact {
            display: flex;
            flex-direction: column;
        }

        .detail-label-compact {
            font-size: 0.6rem;
            color: #666;
            margin-bottom: 1px;
        }

        .detail-value-compact {
            font-weight: 500;
            font-size: 0.65rem;
        }

        /* NOVO ESTILO - Miniatura na visualização rápida */
        .quick-view-foto {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quick-view-foto-mini {
            width: 30px;
            height: 30px;
            border-radius: 3px;
            object-fit: cover;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .quick-view-foto-mini:hover {
            border-color: var(--secondary);
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        .quick-view-foto-placeholder {
            width: 30px;
            height: 30px;
            background-color: #f0f0f0;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 0.8rem;
            border: 1px solid #ddd;
        }

        .quick-view-actions {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            margin-top: 4px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.65rem;
            padding: 2px 5px;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .edit-btn {
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .edit-btn:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .delete-btn {
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .delete-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }

        .view-btn {
            color: var(--info);
            border: 1px solid var(--info);
        }

        .view-btn:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
        }

        .modal-content {
            position: relative;
            width: 90%;
            max-width: 350px;
            margin: 10% auto;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            padding: 15px;
        }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 14px;
            cursor: pointer;
            z-index: 2001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-title {
            margin-bottom: 12px;
            color: var(--primary);
            border-bottom: 1px solid var(--secondary);
            padding-bottom: 6px;
            font-size: 0.9rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 10px;
            color: var(--primary);
            font-size: 0.8rem;
        }

        .loading i {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        /* NOVOS ESTILOS - MANTENDO O PADRÃO ORIGINAL */
        
        /* Modal de visualização completa */
        .modal-visualizacao {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
        }
        
        .modal-visualizacao-content {
            position: relative;
            width: 95%;
            max-width: 600px;
            margin: 5% auto;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            padding: 15px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        /* Informações de visualização */
        .info-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .info-section h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--secondary);
            padding-bottom: 4px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 6px;
            font-size: 0.75rem;
        }
        
        .info-label {
            font-weight: 600;
            color: var(--primary);
            min-width: 120px;
        }
        
        .info-value {
            color: var(--text);
            flex: 1;
        }
        
        .info-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
        }
        
        /* NOVO ESTILO - Visualização da foto */
        .foto-visualizacao {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .foto-visualizacao:hover {
            opacity: 0.9;
        }
        
        .foto-visualizacao img {
            max-width: 100%;
            max-height: 250px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            object-fit: contain;
        }
        
        .foto-visualizacao-placeholder {
            width: 100%;
            height: 150px;
            background-color: #e9ecef;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #aaa;
        }
        
        .foto-visualizacao-placeholder i {
            font-size: 2.5rem;
        }
        
        .foto-visualizacao-placeholder span {
            font-size: 0.8rem;
        }
        
        /* Lista de etapas na visualização */
        .etapas-lista-visualizacao {
            margin-top: 10px;
        }
        
        .etapa-item-visualizacao {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 6px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        
        .etapa-item-visualizacao.aguardando {
            border-left-color: var(--warning);
        }
        
        .etapa-item-visualizacao.producao {
            border-left-color: var(--secondary);
        }
        
        .etapa-item-visualizacao.realizado {
            border-left-color: var(--success);
        }
        
        .etapa-item-visualizacao.parado {
            border-left-color: var(--danger);
        }
        
        .etapa-numero-visualizacao {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.7rem;
            min-width: 25px;
            text-align: center;
        }
        
        .etapa-nome-visualizacao {
            flex: 1;
            font-size: 0.75rem;
            color: var(--text);
        }
        
        .etapa-status-visualizacao {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: bold;
            color: white;
            min-width: 100px;
            text-align: center;
        }
        
        .status-aguardando-bg {
            background-color: var(--warning);
        }
        
        .status-producao-bg {
            background-color: var(--secondary);
        }
        
        .status-realizado-bg {
            background-color: var(--success);
        }
        
        .status-parado-bg {
            background-color: var(--danger);
        }
        
        /* Barra de progresso */
        .progress-container {
            margin-top: 8px;
            margin-bottom: 12px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.7rem;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--success);
            transition: width 0.3s ease;
        }
        
        /* Modal de modelos - mesmo estilo da modal original */
        .modal-modelos {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
        }
        
        .modal-modelos-content {
            position: relative;
            width: 95%;
            max-width: 500px;
            margin: 5% auto;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            padding: 15px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Formulário de modelos - mesmo estilo do formulário principal */
        .form-modelo {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid var(--purple);
        }
        
        .form-modelo h4 {
            margin-bottom: 8px;
            color: var(--primary);
            border-bottom: 1px solid var(--purple);
            padding-bottom: 4px;
            font-size: 0.9rem;
        }
        
        /* Contêiner de etapas */
        .etapas-container {
            margin-top: 8px;
            margin-bottom: 8px;
        }
        
        .etapa-item {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            align-items: center;
        }
        
        .etapa-input {
            flex: 1;
            padding: 5px 7px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.75rem;
            background-color: white;
        }
        
        /* Botões de etapa - mesmo estilo dos outros botões */
        .btn-etapa {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background-color 0.3s;
        }
        
        .btn-etapa:hover {
            background-color: #2980b9;
        }
        
        /* Lista de modelos - estilo compacto similar ao quick-view */
        .modelos-lista {
            margin-top: 15px;
        }
        
        .modelos-lista h4 {
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 0.9rem;
        }
        
        .modelo-item {
            background-color: white;
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 3px solid var(--purple);
        }
        
        .modelo-info h5 {
            color: var(--primary);
            margin-bottom: 4px;
            font-size: 0.8rem;
        }
        
        .modelo-etapas {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .modelo-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: bold;
            color: white;
            display: inline-block;
        }
        
        .status-ativo {
            background-color: var(--success);
        }
        
        .status-inativo {
            background-color: #95a5a6;
        }
        
        .modelo-actions {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            margin-top: 6px;
        }

        /* Botão para carregar etapas */
        .btn-carregar-modelo {
            margin-top: 5px;
            background-color: var(--success);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            width: auto;
        }
        
        .btn-carregar-modelo:hover {
            background-color: #27ae60;
        }

        /* Container de etapas no acompanhamento */
        .etapas-acompanhamento {
            margin-top: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 8px;
            border: 1px solid #e9ecef;
        }

        .etapa-acompanhamento-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            padding: 6px;
            background-color: white;
            border-radius: 3px;
            border-left: 3px solid #ddd;
        }

        .etapa-acompanhamento-item.aguardando {
            border-left-color: var(--warning);
        }

        .etapa-acompanhamento-item.producao {
            border-left-color: var(--secondary);
        }

        .etapa-acompanhamento-item.realizado {
            border-left-color: var(--success);
        }

        .etapa-acompanhamento-item.parado {
            border-left-color: var(--danger);
        }

        .etapa-numero {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.7rem;
            min-width: 20px;
        }

        .etapa-nome {
            flex: 1;
            font-size: 0.75rem;
        }

        .etapa-status-select {
            padding: 3px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.7rem;
            min-width: 120px;
        }

        /* Modal para ampliar foto */
        .foto-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            cursor: pointer;
        }
        
        .foto-modal-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .foto-modal-content img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .foto-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 30px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .foto-modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        /* Responsive - mantendo o padrão original */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }

            .header-contact {
                align-items: center;
            }

            .dashboard-container {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .filter-group {
                flex-direction: column;
            }

            .quick-view-details-compact {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-modelos-content,
            .modal-visualizacao-content {
                width: 90%;
                margin: 10% auto;
            }
            
            .info-row {
                flex-direction: column;
                margin-bottom: 8px;
            }
            
            .info-label {
                min-width: auto;
                margin-bottom: 2px;
            }
            
            .quick-view-actions {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .logo-container {
                flex-direction: column;
                text-align: center;
            }

            .logo-text h1 {
                font-size: 1rem;
            }

            .section-title h2 {
                font-size: 1.2rem;
            }

            .form-actions {
                flex-direction: column;
            }

            .quick-view-details-compact {
                grid-template-columns: 1fr;
            }
            
            .modelo-actions,
            .quick-view-actions {
                flex-wrap: wrap;
            }
            
            .etapa-item-visualizacao {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .etapa-status-visualizacao {
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://i.pinimg.com/1200x/40/a8/e9/40a8e9533769e963fd52ccc646efc7c6.jpg" alt="Costur Confecções" id="logo-image">
                </div>
                <div class="logo-text">
                    <h1>Costur Confecções</h1>
                    <p>Sua marca, nossa costura.</p>
                </div>
            </div>
            <div class="header-contact">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>(81) 9.2140-5569 / (81) 9.9201-4171</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Rua professor ferrucio, 436, São Francisco - Caruaru/PE</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Painel de Acompanhamento -->
    <section id="dashboard" class="dashboard">
        <div class="container">
            <div class="section-title">
                <h2>Painel de Acompanhamento</h2>
            </div>
            
            <!-- Botão para gerenciar modelos -->
            <div class="modelos-btn-container">
                <button class="btn-modelos" onclick="abrirModalModelos()">
                    <i class="fas fa-tshirt"></i> Gerenciar Modelos
                </button>
            </div>
            
            <div class="dashboard-container">
                <!-- Formulário -->
                <div class="form-container">
                    <h3>Novo Acompanhamento</h3>
                    <form id="acompanhamentoForm">
                        <div class="form-group">
                            <label for="cliente">Cliente (Marca)</label>
                            <select id="cliente" required>
                                <option value="">Carregando marcas...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modeloProduto">Modelo de Produto</label>
                            <div style="display: flex; gap: 5px;">
                                <select id="modeloProduto" style="flex: 1;" onchange="carregarEtapasDoModelo()">
                                    <option value="">Selecione um modelo</option>
                                </select>
                                <button type="button" class="btn-carregar-modelo" onclick="abrirModalModelos()">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- NOVO CAMPO - Foto do produto -->
                        <div class="form-group">
                            <label>Foto do Produto</label>
                            <div class="foto-container">
                                <div class="foto-preview" id="fotoPreview" onclick="abrirFotoPreviewAmpliada()">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="foto-upload">
                                    <input type="file" id="fotoInput" accept="image/*" onchange="previewFoto(this)">
                                    <input type="text" id="fotoUrl" class="foto-url-input" placeholder="Ou cole uma URL da imagem" onchange="usarUrlFoto()">
                                    <button type="button" class="foto-remove-btn" onclick="removerFoto()" style="display: none;" id="removerFotoBtn">
                                        <i class="fas fa-trash"></i> Remover foto
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dataAtualizacao">Data de Atualização</label>
                            <input type="text" id="dataAtualizacao" readonly>
                        </div>
                        
                        <!-- As etapas serão carregadas aqui dinamicamente -->
                        <div id="etapasContainer" style="display: none;">
                            <h4 style="font-size: 0.9rem; margin-bottom: 8px; color: var(--primary);">Etapas do Produto</h4>
                            <div id="listaEtapas"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="statusGeral">Status Geral</label>
                            <select id="statusGeral">
                                <option value="Aguardando">Aguardando</option>
                                <option value="Em produção">Em produção</option>
                                <option value="Realizado">Realizado</option>
                                <option value="Parado por falta de material">Parado por falta de material</option>
                                <option value="Parado por falta de eletricidade">Parado por falta de eletricidade</option>
                                <option value="Parado manutenção de máquina">Parado manutenção de máquina</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="observacoes">Observações</label>
                            <input type="text" id="observacoes" placeholder="Observações adicionais">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn" id="saveBtn">Salvar</button>
                            <button type="button" class="btn btn-danger" id="deleteBtn" style="display: none;">Excluir</button>
                        </div>
                    </form>
                </div>
                
                <!-- Visualização Rápida -->
                <div>
                    <!-- Filtro por Cliente -->
                    <div class="filter-container">
                        <h4>Filtrar por Cliente</h4>
                        <div class="filter-group">
                            <select id="filtroCliente" class="filter-select">
                                <option value="">Todos os clientes</option>
                            </select>
                            <button class="filter-btn" onclick="aplicarFiltro()">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                            <button class="filter-btn" onclick="limparFiltro()" style="background-color: #95a5a6;">
                                <i class="fas fa-times"></i> Limpar
                            </button>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 12px; color: var(--primary); font-size: 1rem;">Acompanhamentos</h3>
                    <div class="quick-view-container" id="quickViewContainer">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Carregando acompanhamentos...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para exclusão -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeDeleteModal()">×</button>
            <h3 class="modal-title">Confirmar Exclusão</h3>
            <div class="form-group">
                <label for="senhaExclusao">Digite a senha para excluir:</label>
                <input type="password" id="senhaExclusao" placeholder="Senha de administrador">
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Confirmar Exclusão</button>
                <button type="button" class="btn" onclick="closeDeleteModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para visualização completa -->
    <div id="visualizacaoModal" class="modal-visualizacao">
        <div class="modal-visualizacao-content">
            <button class="close-btn" onclick="fecharModalVisualizacao()">×</button>
            <h3 class="modal-title">Visualização Completa</h3>
            
            <div id="conteudoVisualizacao">
                <!-- Conteúdo será carregado dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal para gerenciamento de modelos -->
    <div id="modelosModal" class="modal-modelos">
        <div class="modal-modelos-content">
            <button class="close-btn" onclick="fecharModalModelos()">×</button>
            <h3 class="modal-title">Gerenciar Modelos de Produtos</h3>
            
            <!-- Formulário para criar/editar modelo -->
            <div class="form-modelo">
                <h4 id="formModeloTitulo">Novo Modelo</h4>
                <div class="form-group">
                    <label for="nomeModelo">Nome do Modelo</label>
                    <input type="text" id="nomeModelo" placeholder="Ex: Calça Jeans, Camiseta Básica" class="form-control">
                </div>
                <div class="form-group">
                    <label for="descricaoModelo">Descrição (opcional)</label>
                    <input type="text" id="descricaoModelo" placeholder="Breve descrição do modelo" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>Etapas do Modelo</label>
                    <div class="etapas-container" id="formEtapasContainer">
                        <!-- Etapas serão adicionadas aqui dinamicamente -->
                    </div>
                    <button type="button" class="btn-etapa" onclick="adicionarEtapaNoFormulario()">
                        <i class="fas fa-plus"></i> Adicionar Etapa
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="statusModelo">Status do Modelo</label>
                    <select id="statusModelo" class="form-control">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-purple" id="salvarModeloBtn" onclick="salvarModelo()">Salvar Modelo</button>
                    <button type="button" class="btn" onclick="limparFormularioModelo()">Cancelar</button>
                </div>
            </div>
            
            <!-- Lista de modelos cadastrados -->
            <div class="modelos-lista">
                <h4>Modelos Cadastrados</h4>
                <div id="listaModelos">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Carregando modelos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para ampliar foto -->
    <div id="fotoModal" class="foto-modal" onclick="fecharFotoModal()">
        <div class="foto-modal-content">
            <span class="foto-modal-close">&times;</span>
            <img id="fotoModalImg" src="" alt="Foto ampliada">
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        // Configurações Firebase (mantenha as existentes)
        const firebaseConfigClientes = {
            apiKey: "AIzaSyCyTwlzsMG5-l07vnrb8XIx9J6AIP_Xuvw",
            authDomain: "cadastro-cliente-6bd66.firebaseapp.com",
            projectId: "cadastro-cliente-6bd66",
            storageBucket: "cadastro-cliente-6bd66.firebasestorage.app",
            messagingSenderId: "492238035100",
            appId: "1:492238035100:web:cfb93092a71798dd2e7559"
        };

        const firebaseConfigAcompanhamentos = {
            apiKey: "AIzaSyDRpSahfuooSK37x4pC9Q9fKUZrVLg7szk",
            authDomain: "painel-de-acompanhamento-9b51a.firebaseapp.com",
            projectId: "painel-de-acompanhamento-9b51a",
            storageBucket: "painel-de-acompanhamento-9b51a.firebasestorage.app",
            messagingSenderId: "441234048828",
            appId: "1:441234048828:web:ca4fe2163aa4b469560039"
        };

        // Initialize Firebase apps
        const appClientes = initializeApp(firebaseConfigClientes, "clientes");
        const appAcompanhamentos = initializeApp(firebaseConfigAcompanhamentos, "acompanhamentos");
        
        const dbClientes = getFirestore(appClientes);
        const dbAcompanhamentos = getFirestore(appAcompanhamentos);

        // Referências DOM
        const acompanhamentoForm = document.getElementById('acompanhamentoForm');
        const clienteSelect = document.getElementById('cliente');
        const dataAtualizacaoInput = document.getElementById('dataAtualizacao');
        const statusGeralSelect = document.getElementById('statusGeral');
        const observacoesInput = document.getElementById('observacoes');
        const saveBtn = document.getElementById('saveBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const quickViewContainer = document.getElementById('quickViewContainer');
        const filtroClienteSelect = document.getElementById('filtroCliente');
        const deleteModal = document.getElementById('deleteModal');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const senhaExclusaoInput = document.getElementById('senhaExclusao');
        
        // NOVAS REFERÊNCIAS - Foto
        const fotoInput = document.getElementById('fotoInput');
        const fotoUrl = document.getElementById('fotoUrl');
        const fotoPreview = document.getElementById('fotoPreview');
        const removerFotoBtn = document.getElementById('removerFotoBtn');
        const fotoModal = document.getElementById('fotoModal');
        const fotoModalImg = document.getElementById('fotoModalImg');
        
        // NOVAS REFERÊNCIAS
        const modelosModal = document.getElementById('modelosModal');
        const visualizacaoModal = document.getElementById('visualizacaoModal');
        const conteudoVisualizacao = document.getElementById('conteudoVisualizacao');
        const modeloProdutoSelect = document.getElementById('modeloProduto');
        const etapasContainer = document.getElementById('etapasContainer');
        const listaEtapas = document.getElementById('listaEtapas');
        
        // Referências para o formulário de modelos
        const nomeModeloInput = document.getElementById('nomeModelo');
        const descricaoModeloInput = document.getElementById('descricaoModelo');
        const statusModeloSelect = document.getElementById('statusModelo');
        const formEtapasContainer = document.getElementById('formEtapasContainer');
        const listaModelos = document.getElementById('listaModelos');
        const salvarModeloBtn = document.getElementById('salvarModeloBtn');
        const formModeloTitulo = document.getElementById('formModeloTitulo');

        // Variáveis globais
        let editId = null;
        let editModeloId = null;
        let clientesAtivos = [];
        let todosAcompanhamentos = [];
        let filtroAtual = '';
        let modelosProdutos = [];
        let etapasAtuais = [];

        // Função para mostrar erro
        function mostrarErro(mensagem) {
            alert("Erro: " + mensagem);
            console.error(mensagem);
        }

        // Função para validar URL de imagem
        function validarUrlImagem(url) {
            return url.match(/\.(jpeg|jpg|gif|png|webp|bmp|svg)$/i) || url.startsWith('data:image');
        }

        // NOVA FUNÇÃO - Preview da foto
        window.previewFoto = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Verificar tamanho do arquivo (máximo 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    mostrarErro("A imagem deve ter no máximo 5MB");
                    input.value = '';
                    return;
                }
                
                // Verificar tipo do arquivo
                if (!file.type.match('image.*')) {
                    mostrarErro("Por favor, selecione uma imagem válida");
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        fotoPreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                        removerFotoBtn.style.display = 'inline-block';
                        // Limpar campo de URL
                        fotoUrl.value = '';
                    } catch (error) {
                        console.error("Erro ao carregar imagem:", error);
                        mostrarErro("Erro ao carregar a imagem. Tente novamente.");
                    }
                };
                
                reader.onerror = function() {
                    mostrarErro("Erro ao ler o arquivo. Tente novamente.");
                };
                
                reader.readAsDataURL(file);
            }
        };

        // NOVA FUNÇÃO - Usar URL da foto (CORRIGIDA)
        window.usarUrlFoto = function() {
            const url = fotoUrl.value.trim();
            if (!url) return;
            
            // Criar uma imagem para testar se a URL é válida
            const img = new Image();
            img.onload = function() {
                try {
                    fotoPreview.innerHTML = `<img src="${url}" alt="Preview">`;
                    removerFotoBtn.style.display = 'inline-block';
                    // Limpar input file
                    fotoInput.value = '';
                } catch (error) {
                    console.error("Erro ao carregar URL:", error);
                    mostrarErro("Erro ao carregar a imagem da URL");
                }
            };
            
            img.onerror = function() {
                mostrarErro("URL da imagem inválida ou inacessível");
            };
            
            img.src = url;
        };

        // NOVA FUNÇÃO - Remover foto
        window.removerFoto = function() {
            fotoPreview.innerHTML = '<i class="fas fa-camera"></i>';
            fotoInput.value = '';
            fotoUrl.value = '';
            removerFotoBtn.style.display = 'none';
        };

        // NOVA FUNÇÃO - Obter foto atual (base64 ou URL)
        function obterFotoAtual() {
            const img = fotoPreview.querySelector('img');
            if (img) {
                return img.src;
            }
            return null;
        }

        // NOVA FUNÇÃO - Carregar foto no preview
        function carregarFotoPreview(fotoSrc) {
            if (fotoSrc) {
                try {
                    fotoPreview.innerHTML = `<img src="${fotoSrc}" alt="Preview">`;
                    removerFotoBtn.style.display = 'inline-block';
                    
                    // Se for URL, colocar no campo de URL
                    if (fotoSrc.startsWith('http')) {
                        fotoUrl.value = fotoSrc;
                    }
                } catch (error) {
                    console.error("Erro ao carregar preview:", error);
                    fotoPreview.innerHTML = '<i class="fas fa-camera"></i>';
                }
            } else {
                fotoPreview.innerHTML = '<i class="fas fa-camera"></i>';
                removerFotoBtn.style.display = 'none';
            }
        }

        // NOVA FUNÇÃO - Abrir foto ampliada do preview
        window.abrirFotoPreviewAmpliada = function() {
            const img = fotoPreview.querySelector('img');
            if (img) {
                abrirFotoAmpliada(img.src);
            }
        };

        // NOVA FUNÇÃO - Abrir foto ampliada
        window.abrirFotoAmpliada = function(src) {
            if (!src) return;
            
            fotoModalImg.src = src;
            fotoModal.style.display = 'block';
        };

        // NOVA FUNÇÃO - Fechar foto ampliada
        window.fecharFotoModal = function() {
            fotoModal.style.display = 'none';
            fotoModalImg.src = '';
        };

        // Atualizar data automaticamente
        function atualizarData() {
            const now = new Date();
            const dataFormatada = now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
            dataAtualizacaoInput.value = dataFormatada;
        }

        // Carregar clientes ativos do Firebase
        async function carregarClientes() {
            try {
                console.log("Carregando clientes ativos...");
                
                const querySnapshot = await getDocs(collection(dbClientes, "clientes"));
                clientesAtivos = [];
                
                querySnapshot.forEach((doc) => {
                    const cliente = doc.data();
                    
                    if (cliente.statusCadastro === "Ativo" && cliente.marca) {
                        clientesAtivos.push({
                            id: doc.id,
                            marca: cliente.marca,
                            nome: cliente.nome || "Cliente sem nome"
                        });
                    }
                });

                console.log("Clientes ativos filtrados:", clientesAtivos);

                // Limpar e preencher select do formulário
                clienteSelect.innerHTML = '<option value="">Selecione uma marca</option>';
                
                // Limpar e preencher select do filtro
                filtroClienteSelect.innerHTML = '<option value="">Todos os clientes</option>';
                
                if (clientesAtivos.length === 0) {
                    clienteSelect.innerHTML = '<option value="">Nenhuma marca ativa encontrada</option>';
                    filtroClienteSelect.innerHTML = '<option value="">Nenhuma marca ativa</option>';
                    return;
                }
                
                clientesAtivos.sort((a, b) => a.marca.localeCompare(b.marca));
                
                clientesAtivos.forEach(cliente => {
                    // Preencher select do formulário
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.marca;
                    clienteSelect.appendChild(option);

                    // Preencher select do filtro
                    const optionFiltro = document.createElement('option');
                    optionFiltro.value = cliente.marca;
                    optionFiltro.textContent = cliente.marca;
                    filtroClienteSelect.appendChild(optionFiltro);
                });

            } catch (error) {
                console.error("Erro ao carregar clientes:", error);
                clienteSelect.innerHTML = '<option value="">Erro ao carregar marcas</option>';
                filtroClienteSelect.innerHTML = '<option value="">Erro ao carregar marcas</option>';
            }
        }

        // Carregar modelos de produtos do Firebase
        async function carregarModelosProdutos() {
            try {
                console.log("Carregando modelos de produtos...");
                
                const q = query(collection(dbAcompanhamentos, "modelosProdutos"), orderBy("nomeModelo"));
                const querySnapshot = await getDocs(q);
                modelosProdutos = [];
                
                querySnapshot.forEach((doc) => {
                    const modelo = doc.data();
                    modelosProdutos.push({
                        id: doc.id,
                        ...modelo
                    });
                });

                console.log("Modelos carregados:", modelosProdutos);
                atualizarSelectModelos();
                exibirListaModelos();

            } catch (error) {
                console.error("Erro ao carregar modelos:", error);
            }
        }

        // Atualizar select de modelos no formulário principal
        function atualizarSelectModelos() {
            modeloProdutoSelect.innerHTML = '<option value="">Selecione um modelo</option>';
            
            const modelosAtivos = modelosProdutos.filter(modelo => modelo.status === "ativo");
            
            if (modelosAtivos.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "Nenhum modelo ativo";
                modeloProdutoSelect.appendChild(option);
                return;
            }
            
            modelosAtivos.forEach(modelo => {
                const option = document.createElement('option');
                option.value = modelo.id;
                option.textContent = modelo.nomeModelo;
                modeloProdutoSelect.appendChild(option);
            });
        }

        // Exibir lista de modelos na modal
        function exibirListaModelos() {
            listaModelos.innerHTML = '';
            
            if (modelosProdutos.length === 0) {
                listaModelos.innerHTML = '<div class="loading"><p>Nenhum modelo cadastrado</p></div>';
                return;
            }
            
            modelosProdutos.forEach(modelo => {
                const modeloDiv = document.createElement('div');
                modeloDiv.className = 'modelo-item';
                
                // Formatar etapas para exibição
                const etapasTexto = modelo.etapas && modelo.etapas.length > 0 
                    ? `Etapas: ${modelo.etapas.length}` 
                    : 'Sem etapas cadastradas';
                
                modeloDiv.innerHTML = `
                    <div class="modelo-info">
                        <h5>${modelo.nomeModelo}</h5>
                        <p class="modelo-etapas">${etapasTexto}</p>
                        <span class="modelo-status status-${modelo.status}">${modelo.status === 'ativo' ? 'Ativo' : 'Inativo'}</span>
                    </div>
                    <div class="modelo-actions">
                        <button class="action-btn edit-btn" onclick="editarModelo('${modelo.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn delete-btn" onclick="excluirModelo('${modelo.id}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                        <button class="action-btn ${modelo.status === 'ativo' ? 'delete-btn' : 'edit-btn'}" 
                                onclick="alternarStatusModelo('${modelo.id}', '${modelo.status}')">
                            <i class="fas ${modelo.status === 'ativo' ? 'fa-toggle-off' : 'fa-toggle-on'}"></i>
                        </button>
                    </div>
                `;
                
                listaModelos.appendChild(modeloDiv);
            });
        }

        // Carregar etapas quando selecionar um modelo
        window.carregarEtapasDoModelo = function() {
            const modeloId = modeloProdutoSelect.value;
            const modelo = modelosProdutos.find(m => m.id === modeloId);
            
            if (modelo && modelo.etapas && modelo.etapas.length > 0) {
                etapasAtuais = modelo.etapas;
                
                // Mostrar container de etapas
                etapasContainer.style.display = 'block';
                listaEtapas.innerHTML = '';
                
                // Criar uma div para cada etapa
                modelo.etapas.forEach((etapa, index) => {
                    const etapaDiv = document.createElement('div');
                    etapaDiv.className = 'etapa-acompanhamento-item aguardando';
                    etapaDiv.innerHTML = `
                        <div class="etapa-numero">${index + 1}</div>
                        <div class="etapa-nome">${etapa}</div>
                        <select class="etapa-status-select" data-etapa-index="${index}" onchange="atualizarStatusEtapa(${index}, this.value)">
                            <option value="Aguardando">Aguardando</option>
                            <option value="Em produção">Em produção</option>
                            <option value="Realizado">Realizado</option>
                            <option value="Parado">Parado</option>
                        </select>
                    `;
                    listaEtapas.appendChild(etapaDiv);
                });
            } else {
                etapasContainer.style.display = 'none';
                etapasAtuais = [];
            }
        };

        // Atualizar status de uma etapa específica
        window.atualizarStatusEtapa = function(index, status) {
            const etapaDiv = listaEtapas.children[index];
            
            // Remover todas as classes de status
            etapaDiv.classList.remove('aguardando', 'producao', 'realizado', 'parado');
            
            // Adicionar classe correspondente ao status
            if (status === 'Aguardando') etapaDiv.classList.add('aguardando');
            else if (status === 'Em produção') etapaDiv.classList.add('producao');
            else if (status === 'Realizado') etapaDiv.classList.add('realizado');
            else if (status === 'Parado') etapaDiv.classList.add('parado');
        };

        // Gerenciamento de Modelos - Modal
        window.abrirModalModelos = function() {
            modelosModal.style.display = "block";
            limparFormularioModelo();
            carregarModelosProdutos();
        };

        window.fecharModalModelos = function() {
            modelosModal.style.display = "none";
        };

        // Abrir modal de visualização
        window.abrirModalVisualizacao = function(id) {
            const acompanhamento = todosAcompanhamentos.find(a => a.id === id);
            if (!acompanhamento) return;
            
            visualizacaoModal.style.display = "block";
            exibirConteudoVisualizacao(acompanhamento);
        };

        // Fechar modal de visualização
        window.fecharModalVisualizacao = function() {
            visualizacaoModal.style.display = "none";
        };

        // Exibir conteúdo na modal de visualização (MODIFICADO - com foto)
        function exibirConteudoVisualizacao(acompanhamento) {
            // Calcular progresso das etapas
            let etapasRealizadas = 0;
            let totalEtapas = 0;
            if (acompanhamento.etapasStatus) {
                totalEtapas = Object.keys(acompanhamento.etapasStatus).length;
                etapasRealizadas = Object.values(acompanhamento.etapasStatus).filter(status => status === 'Realizado').length;
            }
            
            const progresso = totalEtapas > 0 ? Math.round((etapasRealizadas / totalEtapas) * 100) : 0;
            
            // Função para obter classe CSS do status
            function getStatusClass(status) {
                if (!status) return "aguardando";
                if (status === "Aguardando") return "aguardando";
                if (status === "Em produção") return "producao";
                if (status === "Realizado") return "realizado";
                return "parado";
            }
            
            // Função para obter texto do status
            function getStatusText(status) {
                if (!status) return "Aguardando";
                return status;
            }
            
            // Função para obter classe de background do status
            function getStatusBgClass(status) {
                if (!status) return "status-aguardando-bg";
                if (status === "Aguardando") return "status-aguardando-bg";
                if (status === "Em produção") return "status-producao-bg";
                if (status === "Realizado") return "status-realizado-bg";
                return "status-parado-bg";
            }
            
            // NOVO - HTML da foto
            const fotoHtml = acompanhamento.foto ? `
                <div class="foto-visualizacao" onclick="abrirFotoAmpliada('${acompanhamento.foto}')">
                    <img src="${acompanhamento.foto}" alt="Foto do produto">
                </div>
            ` : `
                <div class="foto-visualizacao">
                    <div class="foto-visualizacao-placeholder">
                        <i class="fas fa-camera"></i>
                        <span>Sem foto cadastrada</span>
                    </div>
                </div>
            `;
            
            conteudoVisualizacao.innerHTML = `
                ${fotoHtml}
                
                <div class="info-section">
                    <h4>Informações do Cliente</h4>
                    <div class="info-row">
                        <div class="info-label">Cliente (Marca):</div>
                        <div class="info-value">${acompanhamento.clienteMarca || 'Não informado'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Data de Criação:</div>
                        <div class="info-value">${acompanhamento.dataCriacao || 'Não informada'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Última Atualização:</div>
                        <div class="info-value">${acompanhamento.dataAtualizacao || 'Não informada'}</div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4>Informações do Produto</h4>
                    <div class="info-row">
                        <div class="info-label">Modelo do Produto:</div>
                        <div class="info-value">${acompanhamento.modeloNome || 'Não informado'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Status Geral:</div>
                        <div class="info-value">
                            <span class="info-status status-${getStatusClass(acompanhamento.statusGeral)}">
                                ${getStatusText(acompanhamento.statusGeral)}
                            </span>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Observações:</div>
                        <div class="info-value">${acompanhamento.observacoes || 'Nenhuma observação'}</div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4>Progresso do Produto</h4>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progresso Geral</span>
                            <span>${etapasRealizadas}/${totalEtapas} etapas (${progresso}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progresso}%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4>Etapas do Produto</h4>
                    <div class="etapas-lista-visualizacao" id="listaEtapasVisualizacao">
                        ${acompanhamento.etapas && acompanhamento.etapas.length > 0 ? 
                            acompanhamento.etapas.map((etapa, index) => {
                                const status = acompanhamento.etapasStatus ? acompanhamento.etapasStatus[index] : 'Aguardando';
                                return `
                                    <div class="etapa-item-visualizacao ${getStatusClass(status)}">
                                        <div class="etapa-numero-visualizacao">${index + 1}</div>
                                        <div class="etapa-nome-visualizacao">${etapa}</div>
                                        <div class="etapa-status-visualizacao ${getStatusBgClass(status)}">
                                            ${getStatusText(status)}
                                        </div>
                                    </div>
                                `;
                            }).join('')
                            : '<div class="loading"><p>Nenhuma etapa cadastrada</p></div>'
                        }
                    </div>
                </div>
                
                <div class="form-actions" style="justify-content: center; margin-top: 20px;">
                    <button type="button" class="btn btn-info" onclick="fecharModalVisualizacao()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            `;
        }

        // Adicionar campo de etapa no formulário de modelo
        window.adicionarEtapaNoFormulario = function(valor = '') {
            const etapaDiv = document.createElement('div');
            etapaDiv.className = 'etapa-item';
            etapaDiv.innerHTML = `
                <input type="text" class="etapa-input" value="${valor}" placeholder="Nome da etapa (ex: Corte, Costura)">
                <button type="button" class="btn-etapa delete-btn" onclick="removerEtapa(this)" style="background-color: var(--danger);">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            formEtapasContainer.appendChild(etapaDiv);
        };

        window.removerEtapa = function(botao) {
            botao.parentElement.remove();
        };

        // Salvar modelo
        window.salvarModelo = async function() {
            const nomeModelo = nomeModeloInput.value.trim();
            const descricao = descricaoModeloInput.value.trim();
            const status = statusModeloSelect.value;
            
            if (!nomeModelo) {
                alert("Por favor, insira um nome para o modelo");
                return;
            }
            
            // Coletar etapas
            const etapasInputs = formEtapasContainer.querySelectorAll('.etapa-input');
            const etapas = Array.from(etapasInputs)
                .map(input => input.value.trim())
                .filter(etapa => etapa !== '');
            
            if (etapas.length === 0) {
                alert("Adicione pelo menos uma etapa para o modelo");
                return;
            }
            
            const modeloData = {
                nomeModelo,
                descricao,
                etapas,
                status,
                dataCriacao: new Date().toISOString()
            };
            
            try {
                if (editModeloId) {
                    // Atualizar modelo existente
                    const docRef = doc(dbAcompanhamentos, "modelosProdutos", editModeloId);
                    await updateDoc(docRef, modeloData);
                    console.log("Modelo atualizado:", modeloData);
                } else {
                    // Criar novo modelo
                    await addDoc(collection(dbAcompanhamentos, "modelosProdutos"), modeloData);
                    console.log("Modelo criado:", modeloData);
                }
                
                await carregarModelosProdutos();
                limparFormularioModelo();
                alert(editModeloId ? "Modelo atualizado com sucesso!" : "Modelo criado com sucesso!");
                
            } catch (error) {
                console.error("Erro ao salvar modelo:", error);
                alert("Erro ao salvar modelo. Tente novamente.");
            }
        };

        // Editar modelo
        window.editarModelo = function(id) {
            const modelo = modelosProdutos.find(m => m.id === id);
            if (!modelo) return;
            
            editModeloId = id;
            nomeModeloInput.value = modelo.nomeModelo;
            descricaoModeloInput.value = modelo.descricao || '';
            statusModeloSelect.value = modelo.status;
            formModeloTitulo.textContent = "Editar Modelo";
            salvarModeloBtn.textContent = "Atualizar Modelo";
            
            // Limpar e adicionar etapas
            formEtapasContainer.innerHTML = '';
            if (modelo.etapas) {
                modelo.etapas.forEach(etapa => adicionarEtapaNoFormulario(etapa));
            } else {
                adicionarEtapaNoFormulario();
            }
            
            // Scroll para o formulário
            document.querySelector('.form-modelo').scrollIntoView({ behavior: 'smooth' });
        };

        // Alternar status do modelo (ativo/inativo)
        window.alternarStatusModelo = async function(id, statusAtual) {
            const novoStatus = statusAtual === 'ativo' ? 'inativo' : 'ativo';
            
            if (!confirm(`Tem certeza que deseja ${novoStatus === 'ativo' ? 'ativar' : 'desativar'} este modelo?`)) {
                return;
            }
            
            try {
                const docRef = doc(dbAcompanhamentos, "modelosProdutos", id);
                await updateDoc(docRef, { status: novoStatus });
                
                await carregarModelosProdutos();
                console.log(`Status do modelo ${id} alterado para ${novoStatus}`);
                
            } catch (error) {
                console.error("Erro ao alterar status do modelo:", error);
                alert("Erro ao alterar status. Tente novamente.");
            }
        };

        // Excluir modelo
        window.excluirModelo = async function(id) {
            if (!confirm("Tem certeza que deseja excluir este modelo? Esta ação não pode ser desfeita.")) {
                return;
            }
            
            try {
                await deleteDoc(doc(dbAcompanhamentos, "modelosProdutos", id));
                await carregarModelosProdutos();
                alert("Modelo excluído com sucesso!");
                
            } catch (error) {
                console.error("Erro ao excluir modelo:", error);
                alert("Erro ao excluir modelo. Tente novamente.");
            }
        };

        // Limpar formulário de modelo
        window.limparFormularioModelo = function() {
            nomeModeloInput.value = '';
            descricaoModeloInput.value = '';
            statusModeloSelect.value = 'ativo';
            formEtapasContainer.innerHTML = '';
            adicionarEtapaNoFormulario(); // Adiciona um campo vazio por padrão
            editModeloId = null;
            formModeloTitulo.textContent = "Novo Modelo";
            salvarModeloBtn.textContent = "Salvar Modelo";
        };

        // Funções existentes do painel de acompanhamento
        async function carregarAcompanhamentos() {
            try {
                console.log("Carregando acompanhamentos...");
                
                const querySnapshot = await getDocs(collection(dbAcompanhamentos, "acompanhamentos"));
                todosAcompanhamentos = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    todosAcompanhamentos.push({
                        id: doc.id,
                        ...data
                    });
                });

                console.log("Todos os acompanhamentos carregados:", todosAcompanhamentos);
                aplicarFiltro();

            } catch (error) {
                console.error("Erro ao carregar acompanhamentos:", error);
                quickViewContainer.innerHTML = '<div class="loading"><p>Erro ao carregar acompanhamentos</p></div>';
            }
        }

        // Aplicar filtro por cliente
        window.aplicarFiltro = function() {
            const marcaSelecionada = filtroClienteSelect.value;
            filtroAtual = marcaSelecionada;
            
            let acompanhamentosFiltrados = [...todosAcompanhamentos];
            
            if (marcaSelecionada) {
                acompanhamentosFiltrados = todosAcompanhamentos.filter(acomp => 
                    acomp.clienteMarca === marcaSelecionada
                );
            }
            
            exibirAcompanhamentos(acompanhamentosFiltrados);
        };

        // Limpar filtro
        window.limparFiltro = function() {
            filtroClienteSelect.value = '';
            filtroAtual = '';
            exibirAcompanhamentos(todosAcompanhamentos);
        };

        // Exibir acompanhamentos na tela (MODIFICADO - com foto)
        function exibirAcompanhamentos(acompanhamentos) {
            quickViewContainer.innerHTML = '';

            if (acompanhamentos.length === 0) {
                const mensagem = filtroAtual 
                    ? `Nenhum acompanhamento encontrado para ${filtroAtual}`
                    : 'Nenhum acompanhamento encontrado';
                
                quickViewContainer.innerHTML = `<div class="loading"><p>${mensagem}</p></div>`;
                return;
            }

            // ORDENAR por data de criação mais recente primeiro
            acompanhamentos.sort((a, b) => {
                const dataA = new Date(a.dataCriacao || 0);
                const dataB = new Date(b.dataCriacao || 0);
                return dataB - dataA;
            });

            // Preencher visualização rápida SUPER COMPACTA
            acompanhamentos.forEach(acompanhamento => {
                const quickItem = document.createElement('div');
                quickItem.className = 'quick-view-item';
                
                // Calcular progresso das etapas
                let etapasRealizadas = 0;
                let totalEtapas = 0;
                if (acompanhamento.etapasStatus) {
                    totalEtapas = Object.keys(acompanhamento.etapasStatus).length;
                    etapasRealizadas = Object.values(acompanhamento.etapasStatus).filter(status => status === 'Realizado').length;
                }
                
                const progresso = totalEtapas > 0 ? Math.round((etapasRealizadas / totalEtapas) * 100) : 0;
                
                // NOVO - HTML da miniatura da foto
                const fotoMiniHtml = acompanhamento.foto ? 
                    `<img src="${acompanhamento.foto}" class="quick-view-foto-mini" alt="Foto" onclick="abrirFotoAmpliada('${acompanhamento.foto}')">` : 
                    `<div class="quick-view-foto-placeholder"><i class="fas fa-camera"></i></div>`;
                
                quickItem.innerHTML = `
                    <div class="quick-view-header">
                        <div class="quick-view-cliente">${acompanhamento.clienteMarca || acompanhamento.clienteId || 'Marca não informada'}</div>
                        <div class="quick-view-status status-${getStatusClass(acompanhamento.statusGeral)}">${acompanhamento.statusGeral || 'Sem status'}</div>
                    </div>
                    <div class="quick-view-details-compact">
                        <div class="detail-compact quick-view-foto">
                            ${fotoMiniHtml}
                        </div>
                        <div class="detail-compact">
                            <span class="detail-label-compact">Modelo</span>
                            <span class="detail-value-compact">${acompanhamento.modeloNome || '-'}</span>
                        </div>
                        <div class="detail-compact">
                            <span class="detail-label-compact">Etapas</span>
                            <span class="detail-value-compact">${etapasRealizadas}/${totalEtapas}</span>
                        </div>
                        <div class="detail-compact">
                            <span class="detail-label-compact">Progresso</span>
                            <span class="detail-value-compact">${progresso}%</span>
                        </div>
                        <div class="detail-compact">
                            <span class="detail-label-compact">Atualização</span>
                            <span class="detail-value-compact">${formatarDataCompacta(acompanhamento.dataAtualizacao) || '-'}</span>
                        </div>
                    </div>
                    <div class="quick-view-actions">
                        <button class="action-btn view-btn" onclick="abrirModalVisualizacao('${acompanhamento.id}')">
                            <i class="fas fa-eye"></i> Visualizar
                        </button>
                        <button class="action-btn edit-btn" onclick="editarAcompanhamento('${acompanhamento.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn delete-btn" onclick="abrirModalExclusao('${acompanhamento.id}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                `;
                quickViewContainer.appendChild(quickItem);
            });
        }

        // Formatar data de forma compacta
        function formatarDataCompacta(dataString) {
            if (!dataString) return '';
            return dataString.split(' ')[0];
        }

        // Função auxiliar para obter classe CSS do status
        function getStatusClass(status) {
            if (!status) return "aguardando";
            if (status === "Aguardando") return "aguardando";
            if (status === "Em produção") return "producao";
            if (status === "Realizado") return "realizado";
            return "parado";
        }

        // Salvar ou atualizar acompanhamento (MODIFICADO - com foto)
        acompanhamentoForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const clienteSelecionado = clientesAtivos.find(c => c.id === clienteSelect.value);
                if (!clienteSelecionado) {
                    alert("Selecione uma marca válida");
                    return;
                }
                
                const modeloSelecionado = modelosProdutos.find(m => m.id === modeloProdutoSelect.value);
                if (!modeloSelecionado) {
                    alert("Selecione um modelo válido");
                    return;
                }
                
                // Coletar status das etapas
                const etapasStatus = {};
                const etapaStatusSelects = listaEtapas.querySelectorAll('.etapa-status-select');
                etapaStatusSelects.forEach((select, index) => {
                    etapasStatus[index] = select.value;
                });
                
                // NOVO - Obter foto
                const foto = obterFotoAtual();
                
                const acompanhamento = {
                    clienteId: clienteSelect.value,
                    clienteMarca: clienteSelecionado.marca,
                    modeloId: modeloProdutoSelect.value,
                    modeloNome: modeloSelecionado.nomeModelo,
                    dataAtualizacao: dataAtualizacaoInput.value,
                    etapas: etapasAtuais,
                    etapasStatus: etapasStatus,
                    statusGeral: statusGeralSelect.value,
                    observacoes: observacoesInput.value,
                    foto: foto // NOVO - Salvar foto
                };

                if (!editId) {
                    acompanhamento.dataCriacao = new Date().toLocaleDateString('pt-BR');
                }

                if (editId) {
                    const docRef = doc(dbAcompanhamentos, "acompanhamentos", editId);
                    await updateDoc(docRef, acompanhamento);
                    console.log("Acompanhamento atualizado:", acompanhamento);
                    alert("Acompanhamento atualizado com sucesso!");
                } else {
                    await addDoc(collection(dbAcompanhamentos, "acompanhamentos"), acompanhamento);
                    console.log("Acompanhamento salvo:", acompanhamento);
                    alert("Acompanhamento salvo com sucesso!");
                }
                
                await carregarAcompanhamentos();
                limparFormulario();
                
            } catch (error) {
                console.error("Erro ao salvar acompanhamento:", error);
                alert("Erro ao salvar acompanhamento: " + error.message);
            }
        });

        // Editar acompanhamento (MODIFICADO - com foto)
        window.editarAcompanhamento = async function(id) {
            try {
                const docSnap = await getDocs(collection(dbAcompanhamentos, "acompanhamentos"));
                
                let acompanhamento = null;
                docSnap.forEach((doc) => {
                    if (doc.id === id) {
                        acompanhamento = { id: doc.id, ...doc.data() };
                    }
                });
                
                if (!acompanhamento) {
                    alert("Acompanhamento não encontrado");
                    return;
                }
                
                // Preencher formulário
                clienteSelect.value = acompanhamento.clienteId;
                dataAtualizacaoInput.value = acompanhamento.dataAtualizacao;
                statusGeralSelect.value = acompanhamento.statusGeral || 'Aguardando';
                observacoesInput.value = acompanhamento.observacoes || '';
                
                // NOVO - Carregar foto
                if (acompanhamento.foto) {
                    carregarFotoPreview(acompanhamento.foto);
                } else {
                    removerFoto();
                }
                
                // Preencher modelo e etapas
                if (acompanhamento.modeloId) {
                    modeloProdutoSelect.value = acompanhamento.modeloId;
                    // Carregar etapas do modelo
                    setTimeout(() => {
                        carregarEtapasDoModelo();
                        
                        // Preencher status das etapas se existirem
                        if (acompanhamento.etapasStatus) {
                            setTimeout(() => {
                                Object.keys(acompanhamento.etapasStatus).forEach(index => {
                                    const select = listaEtapas.querySelector(`[data-etapa-index="${index}"]`);
                                    if (select) {
                                        select.value = acompanhamento.etapasStatus[index];
                                        atualizarStatusEtapa(parseInt(index), acompanhamento.etapasStatus[index]);
                                    }
                                });
                            }, 100);
                        }
                    }, 100);
                }
                
                editId = id;
                saveBtn.textContent = "Atualizar";
                deleteBtn.style.display = "inline-block";
                
                document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error("Erro ao carregar acompanhamento para edição:", error);
                alert("Erro ao carregar acompanhamento para edição.");
            }
        };

        // Abrir modal de exclusão
        window.abrirModalExclusao = function(id) {
            editId = id;
            deleteModal.style.display = "block";
            senhaExclusaoInput.value = "";
        };

        // Fechar modal de exclusão
        window.closeDeleteModal = function() {
            deleteModal.style.display = "none";
            editId = null;
        };

        // Confirmar exclusão
        confirmDeleteBtn.addEventListener('click', async () => {
            if (senhaExclusaoInput.value === "CosturADM2023") {
                try {
                    await deleteDoc(doc(dbAcompanhamentos, "acompanhamentos", editId));
                    console.log("Acompanhamento excluído:", editId);
                    
                    await carregarAcompanhamentos();
                    limparFormulario();
                    closeDeleteModal();
                    
                    alert("Acompanhamento excluído com sucesso!");
                } catch (error) {
                    console.error("Erro ao excluir acompanhamento:", error);
                    alert("Erro ao excluir acompanhamento. Tente novamente.");
                }
            } else {
                alert("Senha incorreta. A exclusão não foi realizada.");
            }
        });

        // Limpar formulário (MODIFICADO - resetar foto)
        function limparFormulario() {
            acompanhamentoForm.reset();
            atualizarData();
            editId = null;
            saveBtn.textContent = "Salvar";
            deleteBtn.style.display = "none";
            
            // Resetar campos relacionados a modelos
            modeloProdutoSelect.value = '';
            etapasContainer.style.display = 'none';
            etapasAtuais = [];
            
            // NOVO - Resetar foto
            removerFoto();
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target == visualizacaoModal) {
                fecharModalVisualizacao();
            }
            if (event.target == modelosModal) {
                fecharModalModelos();
            }
        };

        // Inicializar
        async function init() {
            atualizarData();
            await carregarClientes();
            await carregarModelosProdutos();
            await carregarAcompanhamentos();
            
            setInterval(atualizarData, 60000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
